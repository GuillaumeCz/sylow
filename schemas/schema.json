{
  "id": "https://sylow.network/schemas/base.json",
  "$schema": "https://json-schema.org/draft-06/schema",
  "type": "object",
  "description": "Sylow base document schema",
  "required": ["id", "entityId", "created", "mimetype", "version", "summary", "data"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$",
      "description": "A UUID, unique across servers, representing this document."
    },
    "entity_id": {
      "type": "string",
      "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$",
      "description": "The UUID corresponding to the entity that first published this document."
    },
    "created": {
      "type": "integer",
      "description": "Unix timestamp (UTC) for when the first document was first created."
    },
    "updated": {
      "type": "integer",
      "description": "Unix timestamp (UTC) for when the most recent document was most recently updated."
    },
    "mimetype": {
      "type": "string",
      "pattern": "^.*\/.*$",
      "description": "Mimetype corresponding to the enclosed document type."
    },
    "version": {
      "type": "integer",
      "minimum": 1,
      "default": 1,
      "description": "Current version of the document (starts at 1, increments by 1)."
    },
    "public": {
      "type": "boolean",
      "default": false,
      "description": "Was this document published publicly? Default false (published privately)."
    },
    "diffed": {
      "type": "boolean",
      "default": false,
      "description": "Are new versions of this document included as diffs, or revisions with full content? Default false (full content)."
    },
    "encryption": {
      "type": "string",
      "default": "base64",
      "description": "If the document is encrypted, give the Sylow encryption protocol used. Otherwise, documents are encoded in base64."
    },
    "summary": {
      "type": "object",
      "description": "A base64-encoded summary or before-the-fold sample of data to submit with the document. Encrypted with the document's key if this document supports encryption.",
      "properties": {
        "mimetype": {
          "type": "string",
          "default": "text/plain",
          "description": "The mimetype of the enclosed summary, if it is not a plain text object."
        },
        "encoding": {
          "enum": ["url", "base64", "uuid", "none"],
          "default": "none",
          "description": "Either 'url', 'base64', 'uuid' or 'none'. If 'uuid', it should be the UUID of another document to use as reference. Default 'none'."
        },
        "data": {
          "type": "string",
          "description": "The URL, base64-encoded string, UUID or plain text that should represent the summary of this document."
        }
      },
      "required": ["encoding", "data"],
      "additionalProperties": false
    },
    "data": {
      "type": "object",
      "description": "Contains enclosed document data and their revisions. Keys correspond to the version number of the document in question.",
      "patternProperties": {
        "^\\d+$": {
          "type": "object",
          "oneOf": [
            { "$ref": "album.json" },
            { "$ref": "contact.json" },
            { "$ref": "essay.json" },
            { "$ref": "event.json" },
            { "$ref": "file.json" },
            { "$ref": "photo.json" },
            { "$ref": "status.json" }
          ],
          "description": "A base64-encoded version of the document object. Encrypted with the document's key if this document supports encryption."
        }
      }
    },
    "references": {
      "type": "object",
      "description": "Contains idenfitiers for referring to other documents, keyed to points in the document objects.",
      "patternProperties": {
        "^\\d+$": {
          "type": "string",
          "pattern": "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$",
          "description": "The UUID of the document to which this reference points. Encrypted with the document's key if this document supports encryption."
        }
      }
    },
    "mentions": {
      "type": "object",
      "description": "Contains identifiers for referring to other entities, keyed to points in the document objects.",
      "patternProperties": {
        "^\\d+$": {
          "type": "string",
          "format": "email",
          "description": "The name of the entity to which this reference points. Encrypted with the document's key if this document supports encryption."
        }
      }
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": {
          "type": "string"
        }
      },
      "description": "A list of pointers to encrypted tags, to aid filtering and searching."
    },
    "key": {
      "type": "string",
      "description": "A public-key encrypted version of the symmetrical encryption key for this document's data, references and tags. Only required if the document supports encryption."
    }
  }
}
